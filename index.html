<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Email Signature Builder</title>

    <style>
      body {
        font-family: Arial, Helvetica, sans-serif;
        margin: 20px;
      }
      .wrap {
        display: grid;
        grid-template-columns: 360px 1fr;
        gap: 18px;
      }
      .card {
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 14px;
      }
      h1 {
        font-size: 20px;
        margin-bottom: 10px;
      }
      h2 {
        font-size: 16px;
        margin: 0 0 8px 0;
      }
      label {
        display: block;
        font-size: 12px;
        margin-top: 10px;
      }
      input,
      select,
      textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 13px;
        box-sizing: border-box;
      }
      textarea {
        min-height: 70px;
      }
      .row {
        display: flex;
        gap: 10px;
      }
      .row > div {
        flex: 1;
      }

      button {
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid #bbb;
        background: #f7f7f7;
        cursor: pointer;
      }
      button.primary {
        background: #111;
        color: #fff;
        border-color: #111;
      }
      .btnrow {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 12px;
      }

      .previewShell {
        background: #fff;
      }
      .hint {
        font-size: 12px;
        color: #555;
        line-height: 1.4;
        margin-top: 10px;
      }
      .minihint {
        font-size: 12px;
        color: #666;
        margin-top: 6px;
      }

      .status {
        font-size: 12px;
        color: #0a7;
      }
      .status.err {
        color: #b00;
      }

      .codebox {
        width: 100%;
        min-height: 140px;
        font-family: monospace;
        font-size: 12px;
      }
      @media (max-width: 900px) {
        .wrap {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>

  <body>
    <h1>City Forward Collective and CFC Action Fund Email Signature Builder</h1>
    <div class="hint">
      Edit fields → Copy from Preview window → Paste into Gmail or Outlook.
    </div>

    <div class="wrap">
      <!-- CONTROLS -->
      <div class="card">
        <h2>Signature Type</h2>
        <select id="sigType">
          <option value="cfc">City Forward Collective</option>
          <option value="action">CFC Action Fund</option>
        </select>

        <label>Rendering Variant</label>
        <select id="variant">
          <option value="normal">Normal</option>
          <option value="outlookSafe">Outlook-safe</option>
        </select>

        <!-- <label>Logo URL</label> -->
        <!-- <div class="minihint">
          Logo automatically changes when you switch signature type. You may
          override it if needed.
        </div> -->

        <!-- <input
          id="logoUrl"
          type="hidden"
          value="./assets/city-forward-logo.png"
        /> -->

        <div class="row">
          <div>
            <label>Logo Width (px)</label>
            <input
              id="logoWidth"
              type="number"
              min="40"
              max="500"
              value="180"
            />
            <div class="minihint">
              <b>Recommended maximum:</b> 200px (Outlook may resize larger
              logos).
            </div>
          </div>
          <!-- <div>
            <label>Logo Alt Text</label>
            <input id="logoAlt" value="City Forward Collective" />
          </div> -->
        </div>

        <label>Name</label>
        <input id="fullName" value="Name" />

        <label>Pronouns</label>
        <input id="pronouns" value="(Pronouns)" />

        <label>Job Title</label>
        <input id="title" value="Job Title" />

        <div class="row">
          <div>
            <label>Office Phone</label>
            <input id="officePhone" value="Office Phone Number" />
          </div>
          <div>
            <label>Cell Phone</label>
            <input id="cellPhone" value="Cell Phone Number" />
          </div>
        </div>

        <label>Email</label>
        <input id="email" value="Email Address" />

        <label>Website</label>
        <input id="website" value="www.cityforwardcollective.org" />

        <label>Address</label>
        <textarea id="address">
700 W. Virginia St., Suite 604, Milwaukee, WI 53204</textarea
        >

        <div class="btnrow">
          <button class="primary" id="copyRich">Copy signature</button>
          <button id="copyHtml">Copy HTML</button>
          <button id="copyPlain">Copy plain text</button>
        </div>
      </div>

      <!-- PREVIEW -->
      <div class="card previewShell">
        <h2>Preview (this is what you copy)</h2>
        <div id="status" class="status"></div>

        <div
          id="signaturePreview"
          style="padding: 10px; border: 1px dashed #ccc; border-radius: 10px"
        ></div>

        <div class="hint">
          <b>Steps to copy signature:</b>
          <ul>
            <li>
              <b>Gmail:</b> Settings → See all settings → Signature → New →
              <b>Copy from Preview window</b> → Paste → Save.
            </li>
            <li>
              <b>Outlook desktop:</b> File → Options → Mail → Signatures → New →
              <b>Copy from Preview window</b> → Paste. (Make sure to selected
              the Outlook-safe variant if using Outlook desktop.)
            </li>
            <li>
              <b>Outlook web:</b> Settings → Mail → Compose → Signature →
              <b>Copy from Preview window</b> → Paste.
            </li>
          </ul>
        </div>

        <hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0" />

        <h2>HTML (for advanced users)</h2>
        <textarea id="htmlOut" class="codebox" readonly></textarea>
        <hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0" />
        <div
          class="card"
          style="margin-top: 18px; border-color: #eee; background: #fafafa"
        >
          <h2 style="font-size: 16px; margin: 0 0 6px 0">Need help?</h2>
          <div style="font-size: 13px; color: #333; line-height: 1.4">
            Contact Nick Hwang at
            <a
              href="mailto:nickthwang@gmail.com"
              style="color: #395549; text-decoration: none; font-weight: bold"
            >
              nickthwang@gmail.com
            </a>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      const STORAGE_KEY = "signatureBuilderFields";
      const MAIN_COLOR = "#395549";
      const DIVIDER_COLOR = "#ed902d";
      const RECOMMENDED_MAX = 400;
      const HARD_MAX = 500;
      //
      const LOGOS = {
        cfc: "./assets/city-forward-logo.png",
        action: "./assets/cfc-action-fund-logo.png",
      };
      const LOGO_ALT = {
        cfc: "City Forward Collective Logo",
        action: "City Forward Collective Action Fund Logo",
      };

      const $ = (id) => document.getElementById(id);

      function esc(s) {
        return (s ?? "")
          .toString()
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;");
      }

      function digitsForTel(t) {
        return (t ?? "").toString().replace(/[^\d+]/g, "");
      }
      function tel(t) {
        const raw = (t ?? "").toString();
        const d = digitsForTel(raw);
        const count = (d.match(/\d/g) || []).length;
        return count >= 7
          ? `<a href="tel:${esc(
              d
            )}" style="color:inherit;text-decoration:none;">${esc(raw)}</a>`
          : esc(raw);
      }
      function emailLink(t) {
        const raw = (t ?? "").toString().trim();
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(raw)
          ? `<a href="mailto:${esc(
              raw
            )}" style="color:inherit;text-decoration:none;">${esc(raw)}</a>`
          : esc(raw);
      }
      function webLink(t) {
        const raw = (t ?? "").toString().trim();
        const display = raw.replace(/^https?:\/\//i, "");
        const href = /^https?:\/\//i.test(raw) ? raw : `https://${display}`;
        return `<a href="${esc(
          href
        )}" style="color:inherit;text-decoration:none;">${esc(display)}</a>`;
      }

      // Outlook-safe hard sizing; clamp to HARD_MAX (500)
      function logo(url, w, alt) {
        const W = Math.max(40, Math.min(HARD_MAX, Number(w) || 180));
        return `<img src="${esc(url)}" width="${W}"
    style="display:block;border:0;outline:none;text-decoration:none;width:${W}px;min-width:${W}px;max-width:${W}px;height:auto;-ms-interpolation-mode:bicubic;"
    alt="${esc(alt || "")}">`;
      }

      // City Forward layout
      function buildCFC(d) {
        const tightGap = "3px";
        const sectionGap = "10px";

        // Let column expand up to 500 to match new max
        const leftColWidth =
          Math.max(200, Math.min(HARD_MAX, Number(d.logoWidth) || 180)) + 20; // + padding buffer

        return `
<table cellpadding="0" cellspacing="0" style="font-family:Arial;font-size:13px;line-height:1.25;">
<tr>
<td style="padding-right:12px;vertical-align:top;width:${leftColWidth}px;">
  <table cellpadding="0" cellspacing="0">
<tr><td style="color:${MAIN_COLOR};font-weight:bold;font-size:16px;">${esc(
          d.fullName
        )}</td></tr>
<tr><td style="color:${MAIN_COLOR};font-style:italic;font-weight:bold;font-size:13px;padding-top:${tightGap};">${esc(
          d.pronouns
        )}</td></tr>
<tr><td style="color:${MAIN_COLOR};font-size:14px;padding-top:${tightGap};">${esc(
          d.title
        )}</td></tr>

    <tr><td style="padding-top:${sectionGap};">${logo(
          d.logoUrl,
          d.logoWidth,
          d.logoAlt
        )}</td></tr>
  </table>
</td>

<td style="padding-left:12px;border-left:2px solid ${DIVIDER_COLOR};vertical-align:top;">
  <table cellpadding="0" cellspacing="0">
    <tr><td><b style="color:${MAIN_COLOR}">Office:</b> ${tel(
          d.officePhone
        )}</td></tr>
    <tr><td style="padding-top:${tightGap};"><b style="color:${MAIN_COLOR}">Cell:</b> ${tel(
          d.cellPhone
        )}</td></tr>
    <tr><td style="padding-top:${tightGap};"><b style="color:${MAIN_COLOR}">Email:</b> ${emailLink(
          d.email
        )}</td></tr>
    <tr><td style="padding-top:${tightGap};"><b style="color:${MAIN_COLOR}">Web:</b> ${webLink(
          d.website
        )}</td></tr>
    <tr><td style="padding-top:${sectionGap};color:${MAIN_COLOR}">${esc(
          d.address
        )}</td></tr>
  </table>
</td>
</tr>
</table>`;
      }

      // Action Fund layout
      function buildAction(d) {
        const tightGap = "3px";
        const sectionGap = "10px";

        const leftColWidth =
          Math.max(200, Math.min(HARD_MAX, Number(d.logoWidth) || 180)) + 20;

        return `
<table cellpadding="0" cellspacing="0" style="font-family:Arial;font-size:13px;line-height:1.25;">
<tr>
<td style="padding-right:12px;vertical-align:top;width:${leftColWidth}px;">
  <table cellpadding="0" cellspacing="0">
    <tr><td>${logo(d.logoUrl, d.logoWidth, d.logoAlt)}</td></tr>
    <tr><td style="padding-top:${sectionGap};color:${MAIN_COLOR}">${esc(
          d.address
        )}</td></tr>
  </table>
</td>

<td style="padding-left:12px;border-left:2px solid ${DIVIDER_COLOR};vertical-align:top;">
  <table cellpadding="0" cellspacing="0">
<tr><td style="color:${MAIN_COLOR};font-weight:bold;font-size:16px;">${esc(
          d.fullName
        )}</td></tr>
<tr><td style="color:${MAIN_COLOR};font-style:italic;font-weight:bold;font-size:13px;padding-top:${tightGap};">${esc(
          d.pronouns
        )}</td></tr>
<tr><td style="color:${MAIN_COLOR};font-size:14px;padding-top:${tightGap};">${esc(
          d.title
        )}</td></tr>


    <tr><td style="padding-top:${sectionGap};"><b style="color:${MAIN_COLOR}">Office:</b> ${tel(
          d.officePhone
        )}</td></tr>
    <tr><td style="padding-top:${tightGap};"><b style="color:${MAIN_COLOR}">Cell:</b> ${tel(
          d.cellPhone
        )}</td></tr>
    <tr><td style="padding-top:${tightGap};"><b style="color:${MAIN_COLOR}">Email:</b> ${emailLink(
          d.email
        )}</td></tr>
    <tr><td style="padding-top:${tightGap};"><b style="color:${MAIN_COLOR}">Web:</b> ${webLink(
          d.website
        )}</td></tr>
  </table>
</td>
</tr>
</table>`;
      }

      function getData() {
        const sigType = $("sigType").value;

        return {
          sigType,
          variant: $("variant").value,

          logoUrl: LOGOS[sigType],
          logoAlt: LOGO_ALT[sigType],
          logoWidth: $("logoWidth").value,

          fullName: $("fullName").value,
          pronouns: $("pronouns").value,
          title: $("title").value,
          officePhone: $("officePhone").value,
          cellPhone: $("cellPhone").value,
          email: $("email").value,
          website: $("website").value,
          address: $("address").value,
        };
      }

      function render() {
        const d = getData();
        const html = d.sigType === "action" ? buildAction(d) : buildCFC(d);
        $("signaturePreview").innerHTML = html;
        $("htmlOut").value = html;
        render.last = { html, plain: $("signaturePreview").innerText };
        saveToStorage(d);
        //
        console.log("Logo URL:", d.logoUrl);

        // Optional gentle warning in status if above recommended max
        const wNum = Number(d.logoWidth) || 0;
        if (wNum > RECOMMENDED_MAX) {
          $(
            "status"
          ).textContent = `Note: ${wNum}px exceeds recommended max (${RECOMMENDED_MAX}px). Outlook may resize.`;
          $("status").className = "status err";
        } else {
          $("status").textContent = "";
          $("status").className = "status";
        }
      }

      function saveToStorage(data) {
        const payload = {
          fullName: data.fullName,
          pronouns: data.pronouns,
          title: data.title,
          officePhone: data.officePhone,
          cellPhone: data.cellPhone,
          email: data.email,
          website: data.website,
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
      }

      function loadFromStorage() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return;
          const d = JSON.parse(raw);

          if (d.fullName) $("fullName").value = d.fullName;
          if (d.pronouns) $("pronouns").value = d.pronouns;
          if (d.title) $("title").value = d.title;
          if (d.officePhone) $("officePhone").value = d.officePhone;
          if (d.cellPhone) $("cellPhone").value = d.cellPhone;
          if (d.email) $("email").value = d.email;
          if (d.website) $("website").value = d.website;
        } catch (e) {}
      }

      async function doCopyRich() {
        const { html, plain } = render.last || { html: "", plain: "" };
        const item = new ClipboardItem({
          "text/html": new Blob([html], { type: "text/html" }),
          "text/plain": new Blob([plain], { type: "text/plain" }),
        });
        await navigator.clipboard.write([item]);
        $("status").textContent = "Copied signature.";
        $("status").className = "status";
        setTimeout(() => {
          render();
        }, 900);
      }

      $("copyRich").addEventListener("click", doCopyRich);
      $("copyHtml").addEventListener("click", () =>
        navigator.clipboard.writeText($("htmlOut").value)
      );
      $("copyPlain").addEventListener("click", () =>
        navigator.clipboard.writeText($("signaturePreview").innerText)
      );
      document
        .querySelectorAll("input,select,textarea")
        .forEach((el) => el.addEventListener("input", render));

      loadFromStorage();
      //   $("logoAlt").value = LOGO_ALT[$("sigType").value] || "";
      render();
    </script>
  </body>
</html>
